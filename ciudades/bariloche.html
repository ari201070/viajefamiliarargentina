<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title data-i18n="page-title">Bariloche | Viaje Familiar a Argentina</title>
  <!-- <link rel="stylesheet" href="../estilos.css"> --> 
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #333;
      margin: 0; 
      padding: 0;
      padding-top: 70px; 
      transition: direction 0.3s;
    }
    nav { 
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: rgba(255,255,255,0.95);
      padding: 10px 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      box-sizing: border-box;
    }
    nav button, nav select {
      font-weight: bold;
      padding: 8px 12px;
      margin: 0 2px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      background-color: #f0f0f0;
    }
    nav button.active { 
      background: #e6eaff;
      border-color: #6d7fc9;
      font-weight: bold;
    }
    nav a {
      text-decoration: none;
      font-weight: bold;
      color: #007BFF;
      margin-left: auto; 
    }
    .container { 
      padding: 20px;
      max-width: 800px; 
      margin: 0 auto; 
    }
    .cover-image { 
      width: 100%;
      max-width: 700px;
      height: auto;
      display: block;
      margin: 0 auto 10px auto; 
      border-radius: 14px;
      box-shadow: 0 3px 16px rgba(0,0,0,0.15);
    }
    .foto-caption {
      text-align: center;
      color: #555;
      font-size: 0.9em; 
      margin-bottom: 30px;
    }
    h1, h2, h3 { color: #0F4761; }
    ul { margin-bottom: 20px; padding-left: 25px; }
    ul li { margin-bottom: 5px; }
    iframe { border: 1px solid black; width: 100%; max-width: 700px; display: block; margin: 20px auto; }
    table { border-collapse: collapse; width: 100%; max-width: 700px; margin: 20px auto; background: #f7fbff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-radius: 8px; overflow: hidden; }
    th, td { border: 1px solid #b3c7e6; padding: 10px 15px; body:not(.rtl) th, body:not(.rtl) td {
  text-align: left;
}; font-size: 16px; }
    th { background: #e6f0fa; font-weight: bold; }
    .rtl { direction: rtl !important; }
    .rtl nav a { margin-left: 0; margin-right: auto; }
    .rtl ul { padding-right: 25px; padding-left: 0; }
    .rtl th, .rtl td { text-align: right !important; }
    .ai-section { background: #e6f0fa; padding: 20px; border-radius: 8px; margin: 30px auto; max-width: 700px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .ai-section h2 { color: #2176d2; margin-top: 0; }
    .ai-button { background-color: #4CAF50; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; display: block; margin: 15px auto; max-width: 300px; }
    .ai-button:hover { background-color: #45a049; }
    .ai-button:disabled { background-color: #cccccc; cursor: not-allowed; }
    .ai-response { margin-top: 20px; padding: 15px; background-color: #ffffff; border: 1px solid #d0e0f0; border-radius: 5px; white-space: pre-wrap; font-size: 15px; line-height: 1.6; min-height: 50px; }
    .ai-loading { text-align: center; font-style: italic; color: #666; margin-top: 10px; }
  </style>
</head>
<body>
  <nav>
    <button id="btn-es" onclick="translatePage('es')">Español</button>
    <button id="btn-he" onclick="translatePage('he')">עברית</button>
    <select id="moneda" onchange="cambiarMoneda()">
        <option value="ARS">ARS</option>
        <option value="USD">USD</option>
        <option value="EUR">EUR</option>
        <option value="ILS">ILS</option>
    </select>
    <span id="precio-en-moneda-seleccionada"></span>
    <a href="../index.html" data-i18n="common.back-link">⬅ Volver al itinerario</a>
  </nav>

  <div class="container">
    <img src="../docs/imagenes/bariloche/emilio-lujan-HhobdGoYzaA-unsplash.jpg"
        alt="Paisaje de Bariloche"
        class="cover-image"
        id="city-photo"
        data-i18n-alt="foto-caption"
        onerror="this.src='https://placehold.co/700x400/cccccc/333333?text=Imagen+Bariloche'">
    <div class="foto-caption" data-i18n="foto-caption">Paisaje de Bariloche</div>

    <h1 id="city-title" data-i18n="city-title">Bariloche</h1>
    <p id="welcome-text" data-i18n="welcome-text">San Carlos de Bariloche, la capital de los Lagos, es un destino de montaña en la Patagonia argentina, famoso por sus paisajes de bosques, lagos, montañas nevadas y, por supuesto, el chocolate. Ideal para aventuras familiares en cualquier estación.</p>

    <h2 data-i18n="dates-duration-title">Fechas y duración</h2>
    <ul>
      <li data-i18n="stay-duration">**Estadía**: 05/10 al 09/10 (5 días)</li>
      <li data-i18n="how-to-arrive">**Cómo llegar**: Vuelo desde Rosario / Bus de larga distancia</li>
    </ul>

    <h2 id="main-attractions-title" data-i18n="main-attractions-title">Lugares imperdibles</h2>
    <ul id="main-attractions-list">
      <li><a href="https://es.wikipedia.org/wiki/Centro_C%C3%ADvico_de_Bariloche" target="_blank" data-i18n="attraction-0">Centro Cívico</a></li>
      <li><a href="https://es.wikipedia.org/wiki/Lago_Nahuel_Huapi" target="_blank" data-i18n="attraction-1">Lago Nahuel Huapi</a></li>
      <li><a href="https://bariloche.org/es/circuito-chico" target="_blank" data-i18n="attraction-2">Circuito Chico</a></li>
      <li><a href="https://www.catedralaltapatagonia.com/" target="_blank" data-i18n="attraction-3">Cerro Catedral</a></li>
      <li><a href="https://cerrocampanario.com.ar/" target="_blank" data-i18n="attraction-4">Cerro Campanario</a></li>
      <li><a href="https://www.parquesnacionales.gob.ar/areas-protegidas/region-patagonia/nahuel-huapi/bosque-de-arrayanes/" target="_blank" data-i18n="attraction-5">Bosque de Arrayanes</a></li>
      <li><a href="https://www.bariloche.org/es/puerto-blest" target="_blank" data-i18n="attraction-6">Puerto Blest y Cascada de los Cántaros</a></li>
    </ul>

    <h2 data-i18n="recommended-activities-title">Actividades recomendadas</h2>
    <ul>
      <li data-i18n="rec-activity-0">Degustación de chocolates y cervezas artesanales.</li>
      <li data-i18n="rec-activity-1">Navegación por el Lago Nahuel Huapi.</li>
      <li data-i18n="rec-activity-2">Trekking y senderismo (adaptados para familias).</li>
      <li data-i18n="rec-activity-3">Deportes de nieve en invierno (esquí, snowboard, culipatin).</li>
      <li data-i18n="rec-activity-4">Cabalgatas o canopy en los alrededores.</li>
      <li data-i18n="rec-activity-5">Visita a la Colonia Suiza para probar el curanto.</li>
      <li data-i18n="rec-activity-6">Recorrer el Circuito Chico en auto o bicicleta.</li>
    </ul>

    <h2 data-i18n="gastronomy-title">Gastronomía destacada</h2>
    <p data-i18n="gastronomy-intro">La gastronomía de Bariloche es famosa por sus chocolates, carnes de caza (ciervo, jabalí), truchas y ahumados. También hay opciones saludables y para dietas especiales.</p>
    <h3 data-i18n="restaurants-title">Restaurantes recomendados</h3>
    <table>
      <thead>
        <tr>
          <th data-i18n="table-restaurant">Restaurante</th>
          <th data-i18n="common.table-type">Tipo</th>
          <th data-i18n="common.table-gluten-free">Sin Gluten</th>
          <th data-i18n="common.table-sugar-free">Sin Azúcar</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><a href="https://www.elbolichedealberto.com.ar/" target="_blank" data-i18n="restaurant-name-0">El Boliche de Alberto</a></td>
          <td data-i18n="restaurant-type-0">Parrilla / Carnes</td>
          <td data-i18n="common.yes-symbol">✔️</td>
          <td data-i18n="common.no-symbol">❌</td>
        </tr>
        <tr>
          <td><a href="https://www.tripadvisor.com.ar/Restaurant_Review-g312848-d10103700-Reviews-La_Fonda_del_Tio-San_Carlos_de_Bariloche_Province_of_Rio_Negro_Patagonia.html" target="_blank" data-i18n="restaurant-name-1">La Fonda del Tío</a></td>
          <td data-i18n="restaurant-type-1">Comida patagónica casera</td>
          <td data-i18n="common.yes-symbol">✔️</td>
          <td data-i18n="common.yes-symbol">✔️</td>
        </tr>
        <tr>
          <td><a href="https://www.butterfly.com.ar/" target="_blank" data-i18n="restaurant-name-2">Butterfly</a></td>
          <td data-i18n="restaurant-type-2">Alta cocina / Trucha</td>
          <td data-i18n="common.yes-symbol">✔️</td>
          <td data-i18n="common.yes-symbol">✔️</td>
        </tr>
        <tr>
          <td><a href="https://www.rapanui.com.ar/" target="_blank" data-i18n="restaurant-name-3">Rapa Nui</a></td>
          <td data-i18n="restaurant-type-3">Chocolatería / Cafetería</td>
          <td data-i18n="common.yes-symbol">✔️</td>
          <td data-i18n="common.yes-symbol">✔️</td>
        </tr>
      </tbody>
    </table>
    <h3 data-i18n="cafes-title">Confiterías y cafés</h3>
    <table>
      <thead>
        <tr>
          <th data-i18n="table-cafe">Confitería</th>
          <th data-i18n="common.table-type">Tipo</th>
          <th data-i18n="common.table-gluten-free">Sin Gluten</th>
          <th data-i18n="common.table-sugar-free">Sin Azúcar</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><a href="https://www.mamuschka.com/" target="_blank" data-i18n="cafe-name-0">Mamuschka</a></td>
          <td data-i18n="cafe-type-0">Chocolatería / Pastelería</td>
          <td data-i18n="common.yes-symbol">✔️</td>
          <td data-i18n="common.yes-symbol">✔️</td>
        </tr>
        <tr>
          <td><a href="https://www.abuelagoye.com/" target="_blank" data-i18n="cafe-name-1">Abuela Goye</a></td>
          <td data-i18n="cafe-type-1">Chocolatería / Cafetería</td>
          <td data-i18n="common.yes-symbol">✔️</td>
          <td data-i18n="common.yes-symbol">✔️</td>
        </tr>
        <tr>
          <td><a href="https://www.tripadvisor.com.ar/Restaurant_Review-g312848-d10103700-Reviews-El_Almacen_de_Flores-San_Carlos_de_Bariloche_Province_of_Rio_Negro_Patagonia.html" target="_blank" data-i18n="cafe-name-2">El Almacén de Flores</a></td>
          <td data-i18n="cafe-type-2">Café de especialidad</td>
          <td data-i18n="common.yes-symbol">✔️</td>
          <td data-i18n="common.yes-symbol">✔️</td>
        </tr>
      </tbody>
    </table>

    <div class="ai-section">
      <h2 data-i18n="ai-menu-title">Generador de Menú Saludable ✨</h2>
      <p data-i18n="ai-menu-description">Obtén sugerencias de menú para un día completo (desayuno, almuerzo, cena) adaptadas para dietas bajas en carbohidratos, aptas para diabéticos y, si es posible, sin gluten, inspiradas en la gastronomía de Bariloche.</p>
      <button class="ai-button" id="generate-menu-btn" data-i18n="generate-menu-button">Generar Menú</button>
      <div class="ai-loading" id="ai-menu-loading-indicator" style="display:none;" data-i18n="common.ai-loading">Generando...</div>
      <div class="ai-response" id="ai-menu-response"></div>
    </div>

    <div class="ai-section">
      <h2 data-i18n="ai-accommodation-title">Sugerencias de Alojamiento con IA 🏨</h2>
      <p data-i18n="ai-accommodation-description">Obtén recomendaciones de alojamiento en Bariloche, considerando opciones familiares, seguras y bien ubicadas.</p>
      <button class="ai-button" id="generate-accommodation-btn" data-i18n="generate-accommodation-button">Generar Sugerencias</button>
      <div class="ai-loading" id="ai-accommodation-loading-indicator" style="display:none;" data-i18n="common.ai-loading">Generando...</div>
      <div class="ai-response" id="ai-accommodation-response"></div>
    </div>

    <div class="ai-section">
      <h2 data-i18n="ai-family-tips-title">Consejos Adicionales para Familias con IA 👨‍👩‍👧‍👦</h2>
      <p data-i18n="ai-family-tips-description">Recibe consejos personalizados para disfrutar Bariloche en familia, incluyendo actividades, seguridad y logística.</p>
      <button class="ai-button" id="generate-family-tips-btn" data-i18n="generate-family-tips-button">Generar Consejos</button>
      <div class="ai-loading" id="ai-family-tips-loading-indicator" style="display:none;" data-i18n="common.ai-loading">Generando...</div>
      <div class="ai-response" id="ai-family-tips-response"></div>
    </div>

    <div class="ai-section">
      <h2 data-i18n="ai-budget-title">Análisis de Presupuesto con IA 💰</h2>
      <p data-i18n="ai-budget-description">Obtén un análisis y desglose del presupuesto orientativo para tu estadía en Bariloche, con posibles optimizaciones.</p>
      <button class="ai-button" id="generate-budget-btn" data-i18n="generate-budget-button">Analizar Presupuesto</button>
      <div class="ai-loading" id="ai-budget-loading-indicator" style="display:none;" data-i18n="common.ai-loading">Generando...</div>
      <div class="ai-response" id="ai-budget-response"></div>
    </div>

    <h2 data-i18n="accommodation-title">Alojamiento (ejemplos)</h2>
    <ul>
      <li data-i18n="accommodation-0">Hotel Llao Llao (lujo)</li>
      <li data-i18n="accommodation-1">Hotel Panamericano Bariloche</li>
      <li data-i18n="accommodation-2">Cabañas y complejos turísticos con actividades para niños</li>
      <li data-i18n="accommodation-3">Airbnb en el centro o cerca del Circuito Chico</li>
    </ul>

    <h2 data-i18n="coordinates-title">Coordenadas aproximadas</h2>
    <p data-i18n="coordinates-text">41° 08' S 71° 18' O</p>

    <h2 data-i18n="events-agenda-title">Agenda de eventos</h2>
    <ul>
      <li data-i18n="event-0">**(Consultar agenda local)**: Eventos de invierno (Fiesta Nacional de la Nieve).</li>
      <li data-i18n="event-1">**(Consultar agenda local)**: Festivales de música o gastronomía en otras estaciones.</li>
      <li><a href="../docs/agenda/ariflier1970@gmail.com.ical.zip" target="_blank" data-i18n="download-agenda">Descargar agenda completa en formato iCal (.zip)</a></li>
    </ul>

    <h2 data-i18n="family-tips-title">Consejos para familias</h2>
    <ul>
      <li data-i18n="family-tip-0">Vístanse en capas (la temperatura puede variar mucho).</li>
      <li data-i18n="family-tip-1">Reserven excursiones y alojamiento con anticipación, especialmente en temporada alta.</li>
      <li data-i18n="family-tip-2">Hay muchas actividades para niños: parques de nieve, senderos fáciles, paseos en barco.</li>
      <li data-i18n="family-tip-3">La zona es muy segura para explorar en familia.</li>
      <li data-i18n="family-tip-4">Prueben los chocolates locales, pero con moderación si hay restricciones.</li>
    </ul>

    <h2 data-i18n="budget-title">Presupuesto orientativo</h2>
    <table>
      <thead>
        <tr>
          <th data-i18n="common.budget-concept">Concepto</th>
          <th data-i18n="common.budget-price">Precio estimado (USD)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td data-i18n="budget-concept-0">Alojamiento (noche, familia)</td>
          <td data-i18n="budget-price-0">70–180</td>
        </tr>
        <tr>
          <td data-i18n="budget-concept-1">Comida (por día, familia)</td>
          <td data-i18n="budget-price-1">40–90</td>
        </tr>
        <tr>
          <td data-i18n="budget-concept-2">Transporte local (por día)</td>
          <td data-i18n="budget-price-2">5–15</td>
        </tr>
        <tr>
          <td data-i18n="budget-concept-3">Actividades y tours (por día)</td>
          <td data-i18n="budget-price-3">30–80</td>
        </tr>
        <tr>
          <td data-i18n="budget-concept-4">Entradas museos/atracciones</td>
          <td data-i18n="budget-price-4">0–20</td>
        </tr>
      </tbody>
    </table>

    <h2 data-i18n="cultural-tips-title">Tips culturales</h2>
    <ul>
      <li data-i18n="cultural-tip-0">Bariloche tiene una fuerte influencia de inmigrantes suizos y alemanes, visible en su arquitectura y gastronomía.</li>
      <li data-i18n="cultural-tip-1">Es un destino popular para viajes de egresados, por lo que puede haber muchos jóvenes en ciertas épocas.</li>
      <li data-i18n="cultural-tip-2">La cultura de montaña es muy arraigada: respeto por la naturaleza, deportes al aire libre.</li>
    </ul>

    <h2 id="map-title" data-i18n="map-title">Mapa de Bariloche</h2>
    <iframe src="https://www.openstreetmap.org/export/embed.html?bbox=-71.5%2C-41.25%2C-71.1%2C-41.0&amp;layer=mapnik" width="100%" height="350"></iframe>
    <br><small><a href="https://www.openstreetmap.org/#map=12/-41.133/-71.328" target="_blank" data-i18n="common.see-bigger-map">Ver mapa más grande</a></small>
  </div>

  <script>
    let idiomaActual = 'es';
    let monedaActual = 'ARS';
    let currentTranslations = {};
    const currentPageKey = 'bariloche'; 

    let tasasDeCambio = {
      ARS: { ARS: 1, USD: 1/1000, EUR: 1/900, ILS: 1/110 }, 
      USD: { ARS: 1000, USD: 1, EUR: 1000/900, ILS: 1000/110 },
      EUR: { ARS: 900, USD: 900/1000, EUR: 1, ILS: 900/110 },
      ILS: { ARS: 110, USD: 110/1000, EUR: 110/900, ILS: 1 }
    };
    const simbolosMoneda = { ARS: "$", USD: "US$", EUR: "€", ILS: "₪" };

    async function actualizarTasas(callback) {
      try {
        const response = await fetch('https://open.er-api.com/v6/latest/USD');
        const data = await response.json();
        if (data && data.rates) {
          const rates = data.rates;
          tasasDeCambio.ARS = { ARS: 1, USD: 1 / rates.ARS, EUR: (rates.EUR ? (1/rates.ARS) * rates.EUR : 1/900), ILS: (rates.ILS ? (1/rates.ARS) * rates.ILS : 1/110) };
          tasasDeCambio.USD = { ARS: rates.ARS, USD: 1, EUR: rates.EUR || (1000/900) , ILS: rates.ILS || (1000/110) };
          tasasDeCambio.EUR = { ARS: (rates.EUR ? rates.ARS / rates.EUR : 900), USD: (rates.EUR ? 1 / rates.EUR : 900/1000), EUR: 1, ILS: (rates.EUR && rates.ILS ? rates.ILS / rates.EUR : 900/110) };
          tasasDeCambio.ILS = { ARS: (rates.ILS ? rates.ARS / rates.ILS : 110), USD: (rates.ILS ? 1 / rates.ILS : 110/1000), EUR: (rates.ILS && rates.EUR ? rates.EUR / rates.ILS : 110/900), ILS: 1 };
        }
      } catch (error) { console.error("Error al actualizar tasas de cambio:", error); }
      if (typeof callback === "function") callback();
    }

    async function translatePage(language) {
      idiomaActual = language;
      document.body.dir = (language === 'he') ? 'rtl' : 'ltr';
      document.documentElement.lang = language;

      try {
        const response = await fetch(`../locales/${language}.json`);
        if (!response.ok) {
          console.error(`DEBUG: Error loading translation file for ${language}: ${response.statusText}`); // DEBUG
          currentTranslations = {};
        } else {
          currentTranslations = await response.json();
          // LOG 1: VER TODO EL JSON CARGADO
          console.log(`DEBUG: Traducciones cargadas para ${language} (${currentPageKey}):`, JSON.parse(JSON.stringify(currentTranslations)));
        }
      } catch (error) {
        console.error(`DEBUG: Error fetching translation file for ${language}:`, error);
        currentTranslations = {};
      }

      const pageTitleKey = "page-title";
      if (currentTranslations[currentPageKey] && currentTranslations[currentPageKey][pageTitleKey]) {
        document.title = currentTranslations[currentPageKey][pageTitleKey];
      } else if (currentTranslations.common && currentTranslations.common[pageTitleKey]) {
         document.title = currentTranslations.common[pageTitleKey];
      }

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        let translatedText = `[[${key} NOT FOUND IN JSON]]`; 
        let textSource = "NOT FOUND";
        let keyToSearch = key;
        let searchInCommon = false;

        if (key.startsWith('common.')) {
            keyToSearch = key.substring(7);
            searchInCommon = true;
        }

        if (searchInCommon) {
            if (currentTranslations.common && typeof currentTranslations.common[keyToSearch] !== 'undefined') {
              translatedText = currentTranslations.common[keyToSearch];
              textSource = "common";
            }
        } else { 
            if (currentTranslations[currentPageKey] && typeof currentTranslations[currentPageKey][keyToSearch] !== 'undefined') {
              translatedText = currentTranslations[currentPageKey][keyToSearch];
              textSource = currentPageKey;
            } else if (currentTranslations.common && typeof currentTranslations.common[keyToSearch] !== 'undefined') {
              translatedText = currentTranslations.common[keyToSearch];
              textSource = "common (fallback)";
            }
        }
        
        // Enhanced Debugging Log for critical keys
        if (key.includes('restaurant-name') || key.includes('cafe-name') || key.includes('restaurant-type') || key.includes('cafe-type') || key.startsWith('attraction')) {
            console.log(`DEBUG: Element: <${el.tagName.toLowerCase()}${el.id ? ' id="'+el.id+'"' : ''}${el.getAttribute('data-i18n') ? ' data-i18n="'+el.getAttribute('data-i18n')+'"' : ''}>, Searched For Key: "${keyToSearch}", Found In Section: "${textSource}", Resulting Text: "${translatedText}"`);
            if (textSource === "NOT FOUND") {
                 console.log(`   - JSON content for current page ("${currentPageKey}"):`, currentTranslations[currentPageKey] ? JSON.stringify(currentTranslations[currentPageKey]).substring(0,500) + "..." : `"${currentPageKey}" object not in JSON or empty`);
                 console.log(`   - JSON content for common:`, currentTranslations.common ? JSON.stringify(currentTranslations.common).substring(0,500) + "..." : `"common" object not in JSON or empty`);
                 console.log(`   - Specifically, currentTranslations["${currentPageKey}"]["${keyToSearch}"]: `, currentTranslations[currentPageKey] ? currentTranslations[currentPageKey][keyToSearch] : 'undefined');
                 console.log(`   - Specifically, currentTranslations.common["${keyToSearch}"]: `, currentTranslations.common ? currentTranslations.common[keyToSearch] : 'undefined');
            }
        }

        const altKey = el.getAttribute('data-i18n-alt');
        if (altKey) {
            let translatedAlt = altKey; 
            let altKeyToSearch = altKey;
            let searchAltInCommon = false;
            if (altKey.startsWith('common.')) {
                altKeyToSearch = altKey.substring(7);
                searchAltInCommon = true;
            }
            if (searchAltInCommon) {
                if (currentTranslations.common && typeof currentTranslations.common[altKeyToSearch] !== 'undefined') translatedAlt = currentTranslations.common[altKeyToSearch];
            } else {
                if (currentTranslations[currentPageKey] && typeof currentTranslations[currentPageKey][altKeyToSearch] !== 'undefined') translatedAlt = currentTranslations[currentPageKey][altKeyToSearch];
                else if (currentTranslations.common && typeof currentTranslations.common[altKeyToSearch] !== 'undefined') translatedAlt = currentTranslations.common[altKeyToSearch];
            }
            el.alt = translatedAlt;
        }

        if (translatedText.includes('**') || key.includes('event-') || key.includes('stay-duration') || key.includes('how-to-arrive')) {
          el.innerHTML = translatedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        } else {
          el.textContent = translatedText;
        }
      });
      
      document.getElementById('btn-es').classList.toggle('active', language === 'es');
      document.getElementById('btn-he').classList.toggle('active', language === 'he');
      localStorage.setItem('idiomaPreferido', language);
    }

    function cambiarMoneda() {
      monedaActual = document.getElementById('moneda').value;
      localStorage.setItem('monedaPreferida', monedaActual);
      document.getElementById('moneda').value = monedaActual; 
      const precioSpan = document.getElementById('precio-en-moneda-seleccionada');
      if (precioSpan) {
          precioSpan.textContent = simbolosMoneda[monedaActual] || monedaActual;
      }
    }

    async function callGeminiAPI(promptKey, responseDivId, buttonId, loadingIndicatorId) {
      const button = document.getElementById(buttonId);
      const loadingIndicator = document.getElementById(loadingIndicatorId);
      const responseDiv = document.getElementById(responseDivId);
      button.disabled = true;
      loadingIndicator.style.display = 'block';
      responseDiv.textContent = '';
      let promptText = "";
      let errorText = "Error: Prompt no encontrado.";
       if (currentTranslations[currentPageKey] && typeof currentTranslations[currentPageKey][promptKey] !== 'undefined') {
        promptText = currentTranslations[currentPageKey][promptKey];
      } else if (currentTranslations.common && typeof currentTranslations.common[promptKey] !== 'undefined') {
        promptText = currentTranslations.common[promptKey];
      }

      if (currentTranslations.common && currentTranslations.common["ai-error"]) {
            errorText = currentTranslations.common["ai-error"];
      }
      if (currentTranslations[currentPageKey] && currentTranslations[currentPageKey]["ai-error"]){ 
            errorText = currentTranslations[currentPageKey]["ai-error"];
      }
      if (!promptText) {
        responseDiv.textContent = errorText + ` (Prompt ${promptKey} missing)`;
        button.disabled = false;
        loadingIndicator.style.display = 'none';
        return;
      }
      const apiKey = ""; 
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
      const payload = { contents: [{ role: "user", parts: [{ text: promptText }] }], generationConfig: { responseMimeType: "text/plain" } };
      try {
        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        const result = await response.json();
        if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
          responseDiv.textContent = result.candidates[0].content.parts[0].text;
        } else { console.error("Respuesta inesperada de API:", result); responseDiv.textContent = errorText; }
      } catch (error) { console.error("Error llamando a API Gemini:", error); responseDiv.textContent = errorText; } 
      finally { button.disabled = false; loadingIndicator.style.display = 'none'; }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const idiomaGuardado = localStorage.getItem('idiomaPreferido') || 'es';
      const monedaGuardada = localStorage.getItem('monedaPreferida') || 'ARS';
      document.getElementById('moneda').value = monedaGuardada; 
      actualizarTasas(function() {
        cambiarMoneda(); 
        translatePage(idiomaGuardado); 
      });
      document.getElementById('generate-menu-btn').addEventListener('click', () => callGeminiAPI('ai-menu-prompt', 'ai-menu-response', 'generate-menu-btn', 'ai-menu-loading-indicator'));
      document.getElementById('generate-accommodation-btn').addEventListener('click', () => callGeminiAPI('ai-accommodation-prompt', 'ai-accommodation-response', 'generate-accommodation-btn', 'ai-accommodation-loading-indicator'));
      document.getElementById('generate-family-tips-btn').addEventListener('click', () => callGeminiAPI('ai-family-tips-prompt', 'ai-family-tips-response', 'generate-family-tips-btn', 'ai-family-tips-loading-indicator'));
      document.getElementById('generate-budget-btn').addEventListener('click', () => callGeminiAPI('ai-budget-prompt', 'ai-budget-response', 'generate-budget-btn', 'ai-budget-loading-indicator'));
    });
  </script>
</body>
</html>
